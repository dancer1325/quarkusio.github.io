////
This guide is maintained in the main Quarkus repository
and pull requests should be submitted there:
https://github.com/quarkusio/quarkus/tree/main/docs/src/main/asciidoc
////
= Using OpenAPI and Swagger UI
include::_attributes.adoc[]
:categories: web
:summary: This guide explains how to use the OpenAPI extension to generate an OpenAPI descriptor and get a Swagger UI frontend to test your REST endpoints.
:topics: rest,openapi,swagger-ui,dev-ui
:extensions: io.quarkus:quarkus-smallrye-openapi

* goal
    ** how Quarkus application can expose its API description -- through an -- OpenAPI specification
    ** how to test it -- via -- Swagger UI

== Prerequisites

include::{includes}/prerequisites.adoc[]

== Architecture

* straightforward REST application

== Solution

* | `openapi-swaggerui-quickstart` link:{quickstarts-tree-url}/openapi-swaggerui-quickstart[directory]

== Expose OpenAPI Specifications

* Quarkus
    ** provides
        *** ðŸ’¡ https://github.com/smallrye/smallrye-open-api/[SmallRye OpenAPI extension] generates -- , compliant with the https://github.com/eclipse/microprofile-open-api/[MicroProfile OpenAPI] specification, -- your API
https://spec.openapis.org/oas/v3.1.0.html[OpenAPI v3 specification]ðŸ’¡
            **** ðŸ‘€default endpoint `/q/openapi` ðŸ‘€

=== steps
==== add the `openapi` extension | your Quarkus application
* ways

:add-extension-extensions: quarkus-smallrye-openapi
include::{includes}/devtools/extension-add.adoc[]

* -> add | your build file
+
[source,xml,role="primary asciidoc-tabs-target-sync-cli asciidoc-tabs-target-sync-maven"]
.pom.xml
----
<dependency>
    <groupId>io.quarkus</groupId>
    <artifactId>quarkus-smallrye-openapi</artifactId>
</dependency>
----
+
[source,gradle,role="secondary asciidoc-tabs-target-sync-gradle"]
.build.gradle
----
implementation("io.quarkus:quarkus-smallrye-openapi")
----

==== run our application

include::{includes}/devtools/dev.adoc[]

[source, properties, title=application.properties]
----
# if you do NOT like the default endpoint location -> customize
quarkus.smallrye-openapi.path=/swagger

# if you want to request the OpenAPI | JSON format
/q/openapi?format=json
----

== Providing Application Level OpenAPI Annotations

* MicroProfile OpenAPI annotations / describe global API information
    ** are
        *** API Title
        *** API Description
        *** Version
        *** Contact Information
        *** License
    ** uses
        *** ðŸ‘€appropriate OpenAPI annotations |
            **** Jakarta REST `Application` classðŸ‘€, OR
                ***** _Example:_ empty class / extends `jakarta.ws.rs.core.Application`
            **** ".properties"ðŸ‘€

== Enhancing the OpenAPI Schema with Filters

* if you want to change the Generated OpenAPI Schema -- via -- >=1 filter
* filters can run |
    ** build time OR
    ** runtime

[source,java]
----
/**
 * Filter to add custom elements
 */
@OpenApiFilter(OpenApiFilter.RunStage.BUILD) //<1>
public class MyBuildTimeFilter implements OASFilter { //<2>

    private IndexView view;

    public MyBuildTimeFilter(IndexView view) { //<3>
        this.view = view;
    }

    @Override
    public void filterOpenAPI(OpenAPI openAPI) { //<4>
        Collection<ClassInfo> knownClasses = this.view.getKnownClasses();
        Info info = OASFactory.createInfo();
        info.setDescription("Created from Annotated Buildtime filter with " + knownClasses.size() + " known indexed classes");
        openAPI.setInfo(info);
    }

}
----
<1> Annotate method with `@OpenApiFilter` and the run stage (BUILD,RUN,BOTH)
<2> Implement OASFilter and override any of the methods
<3> For Build stage filters, the index can be passed in (optional)
<4> Get a hold of the generated `OpenAPI` Schema, and enhance as required

* Remember that setting fields on the schema will override what has been generated, you might want to get and add to (so modify)
* Also know that the generated values might be null, so you will have to check for that

=== Runtime filters

* Runtime filters
    ** by default, runs | startup (when the final OpenAPI document gets created)
    ** if you want to change runtime filters -> run | every request, making the OpenAPI document dynamic
    ** set `quarkus.smallrye-openapi.always-run-filter=true`

== Loading OpenAPI Schema -- from -- Static Files

Instead of dynamically creating OpenAPI schemas from annotation scanning, Quarkus also supports serving static OpenAPI documents.
The static file to serve must be a valid document conforming to the https://swagger.io/docs/specification[OpenAPI specification].
An OpenAPI document that conforms to the  OpenAPI Specification is itself a valid JSON object, that can be represented in `yaml` or `json` formats.

* To see this in action, we'll put OpenAPI documentation under `META-INF/openapi.yaml` for our `/fruits` endpoints.
Quarkus also supports alternative <<open-document-paths,OpenAPI document paths>> if you prefer.

[source,yaml]
----
openapi: 3.1.0
info:
  title: Static OpenAPI document of fruits resource
  description: Fruit resources Open API documentation
  version: "1.0"

servers:
  - url: http://localhost:8080/q/openapi
    description: Optional dev mode server description

paths:
  /fruits:
    get:
      responses:
        200:
          description: OK - fruits list
          content:
            application/json: {}
    post:
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Fruit'
      responses:
        200:
          description: new fruit resource created
          content:
            application/json: {}
    delete:
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Fruit'
      responses:
        200:
          description: OK - fruit resource deleted
          content:
            application/json: {}
components:
  schemas:
    Fruit:
      properties:
        description:
          type: string
        name:
          type: string
----
By default, a request to `/q/openapi` will serve the combined OpenAPI document from the static file and the model generated from application endpoints code.
We can however change this to only serve the static OpenAPI document by adding `mp.openapi.scan.disable=true` configuration into `application.properties`.

Now, a request to `/q/openapi` endpoint will serve the static OpenAPI document instead of the generated one.

[[open-document-paths]]
[TIP]
.About OpenAPI document paths
====
Quarkus supports various paths to store your OpenAPI document under. We recommend you place it under `META-INF/openapi.yml`.
Alternative paths are:

* `META-INF/openapi.yaml`
* `META-INF/openapi.yml`
* `META-INF/openapi.json`
* `WEB-INF/classes/META-INF/openapi.yml`
* `WEB-INF/classes/META-INF/openapi.yaml`
* `WEB-INF/classes/META-INF/openapi.json`

Live reload of static OpenAPI document is supported during development. A modification to your OpenAPI document will be picked up on fly by Quarkus.
====

== Changing the OpenAPI version

By default, when the document is generated, the OpenAPI version used will be `3.1.0`. If you use a static file as mentioned above, the version in the file
will be used. You can also define the version in SmallRye using the following configuration:

[source, properties]
----
mp.openapi.extensions.smallrye.openapi=3.0.4
----

This might be useful if your API goes through a Gateway that needs a certain version.

[NOTE]
====
Changing the OpenAPI version between `3.0.x` and `3.1.x` versions will result in changes to the rendered document to satisfy the requirements
of the chosen version. A good starting point to learn about the differences between OpenAPI 3.0 and 3.1 is the
https://www.openapis.org/blog/2021/02/16/migrating-from-openapi-3-0-to-3-1-0[OpenAPI Initiative].
====

== Auto-generation of Operation Id

The https://swagger.io/docs/specification/paths-and-operations/[Operation Id] can be set using the `@Operation` annotation, and is in many cases useful when using a tool to generate a client stub from the schema.
The Operation Id is typically used for the method name in the client stub. In SmallRye, you can auto-generate this Operation Id by using the following configuration:

[source, properties]
----
mp.openapi.extensions.smallrye.operationIdStrategy=METHOD
----

Now you do not need to use the `@Operation` annotation. While generating the document, the method name will be used for the Operation Id.

.The strategies available for generating the Operation Id
|===
|Property value |Description

|`METHOD`
|Use the method name.

|`CLASS_METHOD`
|Use the class name (without the package) plus the method.

|`PACKAGE_CLASS_METHOD`
|Use the class name plus the method name.
|===

[[dev-mode]]
== Use Swagger UI for development

When building APIs, developers want to test them quickly. https://swagger.io/tools/swagger-ui/[Swagger UI] is a great tool
permitting to visualize and interact with your APIs.
The UI is automatically generated from your OpenAPI specification.

The Quarkus `smallrye-openapi` extension comes with a `swagger-ui` extension embedding a properly configured Swagger UI page.

[NOTE]
====
By default, Swagger UI is only available when Quarkus is started in dev or test mode.

If you want to make it available in production too, you can include the following configuration in your `application.properties`:
[source, properties]
----
quarkus.swagger-ui.always-include=true
----

This is a build time property, it cannot be changed at runtime after your application is built.

====

By default, Swagger UI is accessible at `/q/swagger-ui`.

You can update the `/swagger-ui` sub path by setting the `quarkus.swagger-ui.path` property in your `application.properties`:

[source, properties]
----
quarkus.swagger-ui.path=my-custom-path
----

[WARNING]
====
The value `/` is not allowed as it blocks the application from serving anything else.
A value prefixed with '/' makes it absolute and not relative.
====

Now, we are ready to run our application:

[source,bash]
----
./mvnw quarkus:dev
----

You can check the Swagger UI path in your application's log:

[source]
----
00:00:00,000 INFO  [io.qua.swa.run.SwaggerUiServletExtension] Swagger UI available at /q/swagger-ui
----

Once your application is started, you can go to http://localhost:8080/q/swagger-ui and play with your API.

You can visualize your API's operations and schemas.
image:openapi-swaggerui-guide-screenshot01.png[alt=Visualize your API]

You can also interact with your API in order to quickly test it.
image:openapi-swaggerui-guide-screenshot02.png[alt=Interact with your API]

Hit `CTRL+C` to stop the application.

=== Styling
You can style the swagger ui by supplying your own logo and css.

==== Logo

To supply your own logo, you need to place a file called `logo.png` in `src/main/resources/META-INF/branding`.

This will set the logo for all UIs (not just swagger ui), so in this case also GraphQL-UI and Health-UI (if included).

If you only want to apply this logo to swagger-ui (and not globally to all UIs) call the file `smallrye-open-api-ui.png`
rather than `logo.png`.

==== CSS

To supply your own css that override/enhance style in the html, you need to place a file called `style.css` in `src/main/resources/META-INF/branding`.

This will add that css to all UIs (not just swagger ui), so in this case also GraphQL-UI and Health-UI (if included).

If you only want to apply this style to swagger-ui (and not globally to all UIs) call the file `smallrye-open-api-ui.css`
rather than `style.css`.

For more information on styling, read this blog entry: https://quarkus.io/blog/stylish-api/

=== Cross Origin Resource Sharing

* if you plan to consume this application -- from -- a SPA / running | DIFFERENT domain -> need to configure CORS (Cross-Origin Resource Sharing)
* xref:security-cors.adoc#cors-filter[CORS filter]

== Configuration Reference

=== MicroProfile OpenAPI

* https://download.eclipse.org/microprofile/microprofile-open-api-3.1.1/microprofile-openapi-spec-3.1.1.html#_core_configurations[MicroProfile OpenAPI Core configuration]
* https://download.eclipse.org/microprofile/microprofile-open-api-3.1.1/apidocs/org/eclipse/microprofile/openapi/annotations/package-summary.html[MicroProfile OpenAPI API Javadoc]

=== OpenAPI

include::{generated-dir}/config/quarkus-smallrye-openapi.adoc[opts=optional, leveloffset=+1]

=== Swagger UI

include::{generated-dir}/config/quarkus-swagger-ui.adoc[opts=optional, leveloffset=+1]
